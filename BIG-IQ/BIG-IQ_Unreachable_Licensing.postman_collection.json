{
	"info": {
		"_postman_id": "311165f9-06c1-4d32-bb8c-6e6fba71e0de",
		"name": "BIG-IQ_Unreachable_Licensing",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Retrieve BIG-IQ Authentication Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "766bb157-29e5-4539-9cd6-01b6b08ab5cb",
						"exec": [
							"eval(postman.getGlobalVariable(\"_f5_workflow_functions\"));",
							"",
							"var populate_vars = [",
							"        {name:\"big_iq_auth_token\", value:\"token.token\"}",
							"    ];",
							"    ",
							"f5_populate_env_vars(populate_vars);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"username\": \"{{big_iq_cred}}\",\n    \"password\": \"{{big_iq_pass}}\"\n}"
				},
				"url": {
					"raw": "https://{{big_iq_mgmt}}/mgmt/shared/authn/login",
					"protocol": "https",
					"host": [
						"{{big_iq_mgmt}}"
					],
					"path": [
						"mgmt",
						"shared",
						"authn",
						"login"
					]
				}
			},
			"response": []
		},
		{
			"name": "Assigning a license to an unreachable device",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "07b94af6-ef45-4c99-93bd-9792d66fbca5",
						"exec": [
							"eval(postman.getGlobalVariable(\"_f5_workflow_functions\"));",
							"",
							"var populate_vars = [",
							"        {name:\"big_iq_task_id\", value:\"id\"}",
							"    ];",
							"    ",
							"f5_populate_env_vars(populate_vars);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "X-F5-Auth-Token",
						"value": "{{big_iq_auth_token}}",
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman."
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"licensePoolName\": \"F5-BIG-MSP-LOADV9-LIC\",\n    \"command\": \"assign\",\n    \"address\": \"10.0.0.50\",\n    \"assignmentType\": \"UNREACHABLE\",\n    \"macAddress\": \"11:11:11:11:11:11\",\n    \"hypervisor\": \"kvm\",\n    \"unitOfMeasure\": \"yearly\",\n    \"tenant\": \"Hidden DataCentre\"\n}"
				},
				"url": {
					"raw": "https://{{big_iq_mgmt}}/mgmt/cm/device/tasks/licensing/pool/member-management/",
					"protocol": "https",
					"host": [
						"{{big_iq_mgmt}}"
					],
					"path": [
						"mgmt",
						"cm",
						"device",
						"tasks",
						"licensing",
						"pool",
						"member-management",
						""
					]
				}
			},
			"response": []
		},
		{
			"name": "Poll for unreachable license task completion",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "3b883d1c-c75e-4bcf-8a70-7a1d95c5793a",
						"exec": [
							"eval(postman.getGlobalVariable(\"_f5_workflow_functions\"));",
							"",
							"var populate_vars = [",
							"        {name:\"big_iq_license_file\", value:\"licenseText\"}",
							"    ];",
							"    ",
							"f5_populate_env_vars(populate_vars);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "X-F5-Auth-Token",
						"value": "{{big_iq_auth_token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "https://{{big_iq_mgmt}}/mgmt/cm/device/tasks/licensing/pool/member-management/{{big_iq_task_id}}",
					"protocol": "https",
					"host": [
						"{{big_iq_mgmt}}"
					],
					"path": [
						"mgmt",
						"cm",
						"device",
						"tasks",
						"licensing",
						"pool",
						"member-management",
						"{{big_iq_task_id}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Retrieve BIG-IP Authentication Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "766bb157-29e5-4539-9cd6-01b6b08ab5cb",
						"exec": [
							"eval(postman.getGlobalVariable(\"_f5_workflow_functions\"));",
							"",
							"var populate_vars = [",
							"        {name:\"big_ip_auth_token\", value:\"token.token\"}",
							"    ];",
							"    ",
							"f5_populate_env_vars(populate_vars);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"username\": \"{{big_ip_cred}}\",\n    \"password\": \"{{big_ip_pass}}\",\n    \"loginProviderName\": \"tmos\"\n}"
				},
				"url": {
					"raw": "https://{{big_ip_mgmt}}/mgmt/shared/authn/login",
					"protocol": "https",
					"host": [
						"{{big_ip_mgmt}}"
					],
					"path": [
						"mgmt",
						"shared",
						"authn",
						"login"
					]
				}
			},
			"response": []
		},
		{
			"name": "Assign Unreachable license to BIG-IP",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "07b94af6-ef45-4c99-93bd-9792d66fbca5",
						"exec": [
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "noauth"
				},
				"method": "PUT",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "X-F5-Auth-Token",
						"value": "{{big_ip_auth_token}}",
						"warning": "This is a duplicate header and will be overridden by the Authorization header generated by Postman."
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"licenseText\": \"{{big_iq_license_file}}\"\n}"
				},
				"url": {
					"raw": "https://{{big_ip_mgmt}}/tm/shared/licensing/registration",
					"protocol": "https",
					"host": [
						"{{big_ip_mgmt}}"
					],
					"path": [
						"tm",
						"shared",
						"licensing",
						"registration"
					]
				}
			},
			"response": []
		}
	]
}